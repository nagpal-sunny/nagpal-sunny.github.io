<!doctype html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="ARC in Swift" /><meta property="og:locale" content="en" /><meta name="description" content="One of the key factors for the success of any application is its performance. Effective Memory Management in an application is crucial for better performance of the application. iOS applications developed using Swift language rely on ARC for tracking and managing application memory usage. ARC uses reference counting to manage the application memory." /><meta property="og:description" content="One of the key factors for the success of any application is its performance. Effective Memory Management in an application is crucial for better performance of the application. iOS applications developed using Swift language rely on ARC for tracking and managing application memory usage. ARC uses reference counting to manage the application memory." /><link rel="canonical" href="http://chewcode.blog/posts/ios/ios%20memory%20management/arc-in-swift/" /><meta property="og:url" content="http://chewcode.blog/posts/ios/ios%20memory%20management/arc-in-swift/" /><meta property="og:site_name" content="Saurav Nagpal Writings" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-15T14:22:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ARC in Swift" /><meta name="twitter:site" content="@nagpalsaurav" /><meta name="google-site-verification" content="_7CbT2oLxEbzhBcpoyPoHWtOLgC2fJY_oGmcFFv48bM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-07-15T14:22:00+05:30","datePublished":"2023-07-15T14:22:00+05:30","description":"One of the key factors for the success of any application is its performance. Effective Memory Management in an application is crucial for better performance of the application. iOS applications developed using Swift language rely on ARC for tracking and managing application memory usage. ARC uses reference counting to manage the application memory.","headline":"ARC in Swift","mainEntityOfPage":{"@type":"WebPage","@id":"http://chewcode.blog/posts/ios/ios%20memory%20management/arc-in-swift/"},"url":"http://chewcode.blog/posts/ios/ios%20memory%20management/arc-in-swift/"}</script><title>ARC in Swift | Saurav Nagpal Writings</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Saurav Nagpal Writings"><meta name="application-name" content="Saurav Nagpal Writings"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> </a><div class="site-title"> <a href="/">Saurav Nagpal Writings</a></div><div class="site-subtitle fst-italic">Articles about Swift and iOS development, by Saurav Nagpal</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/apps/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>APPS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/nagpal-saurav" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/nagpalsaurav" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['nagpalsaurav','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ARC in Swift</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>ARC in Swift</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1689411120" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 15, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/nagpalsaurav">Saurav Nagpal</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1144 words" > <em>6 min</em> read</span></div></div></div><div class="post-content"><p>One of the key factors for the success of any application is its performance. Effective Memory Management in an application is crucial for better performance of the application. iOS applications developed using Swift language rely on ARC for tracking and managing application memory usage. ARC uses reference counting to manage the application memory.</p><h1 id="what-is-arc">What is ARC?</h1><p>ARC is a memory management tool which tracks and manages the application memory. It is a compiler-driven feature. It observes the reference count of an object of a class to manage and free the memory. So the question is what is reference count?</p><p>Reference count in simple language is the ‚Äúnumber of pointers to any object‚Äù.</p><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">Amount</span> <span class="o">=</span> <span class="kt">Int</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="kt">Trip</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Amount</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="k">self</span><span class="o">.</span><span class="n">totalSpending</span> <span class="o">=</span> <span class="n">totalSpending</span>
    <span class="p">}</span>
  <span class="p">}</span></code></pre></figure><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="c1">//Uses of Trip Class</span>
  <span class="k">let</span> <span class="nv">goaTrip</span> <span class="o">=</span> <span class="kt">Trip</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="s">"Panji"</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="mi">50000</span><span class="p">)</span> <span class="c1">//init is one pointer to Object of</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"I spent Rs </span><span class="se">\(</span><span class="n">goaTrip</span><span class="o">.</span><span class="n">totalSpending</span><span class="se">)</span><span class="s"> in goa trip"</span><span class="p">)</span>
  
  <span class="k">var</span> <span class="nv">tripToBeach</span> <span class="o">=</span> <span class="p">[</span><span class="n">goaTrip</span><span class="p">]</span> <span class="c1">// One more pointer to goaTrip</span>
  <span class="k">var</span> <span class="nv">recentTrip</span> <span class="o">=</span> <span class="n">goaTrip</span>              <span class="c1">// One more pointer to goaTrip</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"I spent Rs </span><span class="se">\(</span><span class="n">recentTrip</span><span class="o">.</span><span class="n">totalSpending</span><span class="se">)</span><span class="s"> during recentTrip"</span><span class="p">)</span></code></pre></figure><p>Reference counting only applies to class instances, so struct &amp; enum do not participate in reference counting.</p><h1 id="how-arc-works">How ARC Works?</h1><p>As mentioned, ARC is a compiler-driven feature. It inserts retain and release statements during compilation.</p><ul><li>Retain - increase the reference count.<li>Release - decrease the reference count.</ul><div id="divActivites" name="divActivites" style="padding-left:10px; padding-right:10px; background-color: #FFFFE0; border:1px solid black;"> <b><span style="color:#A8571B">#TechShorts</span></b> <br /> ARC is the compiler-driven feature and it injects retain/release statements in a code during compilation time.</div><h4 id="how-does-the-compiler-decide-when-to-insert-retainrelease"><span class="me-2">How does the compiler decide when to insert retain/release?</span><a href="#how-does-the-compiler-decide-when-to-insert-retainrelease" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><blockquote><p>Object life cycle in Swift begins with init and ends at last use.</p></blockquote><p>ARC decide based on the above when to add retain and release statement.</p><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">Amount</span> <span class="o">=</span> <span class="kt">Int</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="kt">Trip</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Amount</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="k">self</span><span class="o">.</span><span class="n">totalSpending</span> <span class="o">=</span> <span class="n">totalSpending</span>
    <span class="p">}</span>
  <span class="p">}</span></code></pre></figure><p><a href="/Assest/iOS/arc/arcCompile.png" class="popup img-link "><img data-src="/Assest/iOS/arc/arcCompile.png" class="lazyload" data-proofer-ignore></a></p><p>The object life cycle in Swift is different from the other language. In most of the other languages, it ends at the closing brace.</p><p>However, code should not be written based on this assumption as it might change with future compiler changes. For example, the following code is a good example of a team nightmare that suddenly a working code stopped.</p><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">func</span> <span class="nf">explainWrongAssumptionUses</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//My trip List</span>
    <span class="k">let</span> <span class="nv">goaTrip</span> <span class="o">=</span> <span class="kt">Trip</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="s">"Panji"</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="mi">50000</span><span class="p">)</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">weakRefrenceToGoaTrip</span> <span class="o">=</span> <span class="n">goaTrip</span>
    
    <span class="k">if</span> <span class="k">let</span> <span class="nv">strongRefrenceToGoaTrip</span> <span class="o">=</span>  <span class="n">weakRefrenceToGoaTrip</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"I used weak reference here: Goa Trip Rs </span><span class="se">\(</span><span class="n">strongRefrenceToGoaTrip</span><span class="o">.</span><span class="n">totalSpending</span><span class="se">)</span><span class="s">   
  during the recent trip"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span></code></pre></figure><p>In the above case, it is wrong to assume that goaWeakTrip will always be there. The last use of the object is weak var weakRefrenceToGoaTrip = goaTrip and the compiler will insert release after this statement.</p><p>So print statement here totally depends upon how the compiler works. if an Object‚Äôs life cycle in Swift begins with init and ends at last use. is strictly followed by the compiler then 50000 is the result. In the future, due to some drawbacks of this approach, Apple decided the scope based on the brace start and end then the result will be different.</p><h1 id="arc-need-your-help">ARC need your help.</h1><p>ARC cannot detect or break **Reference cycle **. If object holds a strong reference to each other directly or indirectly in that case memory cannot be released of the objects.</p><p><a href="/Assest/iOS/arc/arcRefrencecycle.png" class="popup img-link "><img data-src="/Assest/iOS/arc/arcRefrencecycle.png" class="lazyload" data-proofer-ignore></a></p><p>In the Direct case, the Trip and TravelDiary objects are strongly held together. Therefore, releasing one object requires the release of the other object as well. We can break the reference cycle here by making reference weak in the Trip object for the TravelDiary.</p><p>In the Indirect case, the Person object is strongly held TravelDiary Object. TravelDiary strongly holds the trip object and further Trip holds the person object strongly. Therefore, releasing an Object in this scenario requires other two objects should be released. We can break the reference cycle here by keeping Person Object in the Trip object weak.</p><h4 id="weak--unowned-reference-cycle"><span class="me-2">Weak &amp; Unowned Reference Cycle</span><a href="#weak--unowned-reference-cycle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>To break the reference cycle weak and unowned keywords can be used. Both reference type does not participate in reference counting.</p><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">public</span> <span class="kd">class</span> <span class="kt">TravelDiary</span> <span class="p">{</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">travels</span><span class="p">:</span> <span class="p">[</span><span class="kt">Trip</span><span class="p">]</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">travels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">addTravel</span><span class="p">(</span><span class="n">_</span> <span class="nv">travel</span><span class="p">:</span> <span class="kt">Trip</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">travels</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">travel</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span></code></pre></figure><p>Weak reference can be used when you are not sure about the life cycle of the referred object. It will automatically be set to nil if the object reference count becomes zero. The only constraint with weak is must be optional.</p><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">public</span> <span class="kd">class</span> <span class="kt">Trip</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Amount</span>
    <span class="kd">public</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">travelDiary</span><span class="p">:</span> <span class="kt">TravelDiary</span><span class="p">?</span>
    
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="k">self</span><span class="o">.</span><span class="n">totalSpending</span> <span class="o">=</span> <span class="n">totalSpending</span>
    <span class="p">}</span>
 <span class="p">}</span></code></pre></figure><p>Unowned reference can be used when you are sure about the life cycle of the referred object and it will not be deallocated. It can be used with an object which has an equal or greater life cycle. Unowned references can be declared as non-optional and faster access as compared to weak ones. The weak need to unwrap to access the value.</p><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">public</span> <span class="kd">class</span> <span class="kt">Trip</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Amount</span>
    <span class="kd">public</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">travelDiary</span><span class="p">:</span> <span class="kt">TravelDiary</span><span class="p">?</span>
    
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="k">self</span><span class="o">.</span><span class="n">totalSpending</span> <span class="o">=</span> <span class="n">totalSpending</span>
    <span class="p">}</span>
 <span class="p">}</span></code></pre></figure><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="k">let</span> <span class="nv">travelDiary</span> <span class="o">=</span> <span class="kt">TravelDiary</span><span class="p">()</span>

  <span class="c1">//unowned uses</span>
  <span class="k">let</span> <span class="nv">manaliTrip</span> <span class="o">=</span> <span class="kt">Trip</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="s">"Manali"</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="mi">40000</span><span class="p">,</span> <span class="nv">travelDiary</span><span class="p">:</span> <span class="n">travelDiary</span><span class="p">)</span>

  <span class="c1">//weak uses</span>
  <span class="k">let</span> <span class="nv">manaliTrip</span> <span class="o">=</span> <span class="kt">Trip</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="s">"Manali"</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="mi">40000</span><span class="p">)</span>
  <span class="n">manaliTrip</span><span class="o">.</span><span class="n">travelDiary</span> <span class="o">=</span> <span class="n">travelDiary</span></code></pre></figure><div id="divActivites" name="divActivites" style="padding-left:10px; padding-right:10px; background-color: #FFFFE0; border:1px solid black;"> <b><span style="color:#A8571B">#TechShorts</span></b> <br /> A weak reference is automatically set to nil if no strong reference remains and a weak reference is always optional. Unowned references will refer to deallocated memory if no strong reference remains, so the application can crash. Unowned is always non-optional.</div><h1 id="bonus">Bonus.</h1><p>There are safe ways to access the weak reference to avoid unexpected results or fatal exceptions (force unwrap) at run time.</p><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">public</span> <span class="kd">class</span> <span class="kt">Trip</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Amount</span>
    <span class="kd">public</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">travelDiary</span><span class="p">:</span> <span class="kt">TravelDiary</span><span class="p">?</span>
    
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">isExistInTravelDiary</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">travelDiary</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">travelDiary</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">travelDiary</span><span class="o">.</span><span class="n">travels</span><span class="o">.</span><span class="n">filter</span><span class="p">{</span>
                <span class="nv">$0</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="k">self</span><span class="o">.</span><span class="n">city</span>
            <span class="p">}</span><span class="o">.</span><span class="n">first</span> <span class="o">!=</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="k">self</span><span class="o">.</span><span class="n">totalSpending</span> <span class="o">=</span> <span class="n">totalSpending</span>
    <span class="p">}</span>
  <span class="p">}</span>

   <span class="kd">public</span> <span class="kd">class</span> <span class="kt">TravelDiary</span> <span class="p">{</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">travels</span><span class="p">:</span> <span class="p">[</span><span class="kt">Trip</span><span class="p">]</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">travels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">addTravel</span><span class="p">(</span><span class="n">_</span> <span class="nv">travel</span><span class="p">:</span> <span class="kt">Trip</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">travels</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">travel</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span></code></pre></figure><h4 id="option-1-withextendedlifetime"><span class="me-2">Option 1: withExtendedLifetime</span><a href="#option-1-withextendedlifetime" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">func</span> <span class="nf">prepareTravelDiary</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//Manali Trip</span>
    <span class="k">let</span> <span class="nv">travelDiary</span> <span class="o">=</span> <span class="kt">TravelDiary</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">manaliTrip</span> <span class="o">=</span> <span class="kt">Trip</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="s">"Manali"</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="mi">40000</span><span class="p">)</span>
    <span class="n">manaliTrip</span><span class="o">.</span><span class="n">travelDiary</span> <span class="o">=</span> <span class="n">travelDiary</span>
    
    <span class="n">travelDiary</span><span class="o">.</span><span class="nf">addTravel</span><span class="p">(</span><span class="n">manaliTrip</span><span class="p">)</span>
    
    <span class="nf">withExtendedLifetime</span><span class="p">(</span><span class="n">travelDiary</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">existString</span> <span class="o">=</span> <span class="n">manaliTrip</span><span class="o">.</span><span class="n">isExistInTravelDiary</span> <span class="p">?</span> <span class="s">"exist"</span><span class="p">:</span> <span class="s">"not exist"</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Manali Travel </span><span class="se">\(</span><span class="n">existString</span><span class="se">)</span><span class="s"> in Travel Diary"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span></code></pre></figure><h4 id="option-2-strong-reference-capture"><span class="me-2">Option 2: Strong Reference Capture</span><a href="#option-2-strong-reference-capture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><figure class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">func</span> <span class="nf">prepareStrongTravelDiary</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//Manali Trip</span>
    <span class="k">let</span> <span class="nv">travelDiary</span> <span class="o">=</span> <span class="kt">TravelDiary</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">manaliTrip</span> <span class="o">=</span> <span class="kt">Trip</span><span class="p">(</span><span class="nv">city</span><span class="p">:</span> <span class="s">"Manali"</span><span class="p">,</span> <span class="nv">totalSpending</span><span class="p">:</span> <span class="mi">40000</span><span class="p">)</span>
    <span class="n">manaliTrip</span><span class="o">.</span><span class="n">travelDiary</span> <span class="o">=</span> <span class="n">travelDiary</span>
    
    <span class="n">travelDiary</span><span class="o">.</span><span class="nf">addTravel</span><span class="p">(</span><span class="n">manaliTrip</span><span class="p">)</span>
    <span class="nf">processTrip</span><span class="p">(</span><span class="n">manaliTrip</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">processTrip</span><span class="p">(</span><span class="n">_</span> <span class="nv">trip</span><span class="p">:</span> <span class="kt">Trip</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//somewhere in code in other method</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">travelDiary</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">travelDiary</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">existString</span> <span class="o">=</span> <span class="n">trip</span><span class="o">.</span><span class="n">isExistInTravelDiary</span> <span class="p">?</span> <span class="s">"exist"</span> <span class="p">:</span> <span class="s">"not exist"</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">trip</span><span class="o">.</span><span class="n">city</span><span class="se">)</span><span class="s"> Travel </span><span class="se">\(</span><span class="n">existString</span><span class="se">)</span><span class="s"> in Travel Diary"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span></code></pre></figure></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/ios/'>iOS</a>, <a href='/categories/ios-memory-management/'>iOS Memory Management</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/arc/" class="post-tag no-text-decoration" >ARC</a> <a href="/tags/swift-arc/" class="post-tag no-text-decoration" >Swift ARC</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ARC%20in%20Swift%20-%20Saurav%20Nagpal%20Writings&url=http%3A%2F%2Fchewcode.blog%2Fposts%2Fios%2Fios%2520memory%2520management%2Farc-in-swift%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ARC%20in%20Swift%20-%20Saurav%20Nagpal%20Writings&u=http%3A%2F%2Fchewcode.blog%2Fposts%2Fios%2Fios%2520memory%2520management%2Farc-in-swift%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=http%3A%2F%2Fchewcode.blog%2Fposts%2Fios%2Fios%2520memory%2520management%2Farc-in-swift%2F&text=ARC%20in%20Swift%20-%20Saurav%20Nagpal%20Writings" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/ios/ios%20beta%20build/iOS-Custom-Build-Scheme/">Distribute iOS Beta Build (Scheme & Configurations)</a><li class="text-truncate lh-lg"> <a href="/posts/design%20pattern/clean%20code/templatepattern/">Design Pattern Series: Template Pattern (Behaviour Pattern)</a><li class="text-truncate lh-lg"> <a href="/posts/swift/swift%20safety/Swift-(Nil-Coalescing)-Do's-and-Don't/">Swift ?? (Nil Coalescing) Do's and Don't</a><li class="text-truncate lh-lg"> <a href="/posts/crossplatform/flutter/crossplatform-Flutter-on-Apple-Silicon-Mac/">Flutter on Apple Silicon Mac: Cocoa-pods Issue</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/apps/">Apps</a> <a class="post-tag btn btn-outline-primary" href="/tags/apps/">apps</a> <a class="post-tag btn btn-outline-primary" href="/tags/arc/">ARC</a> <a class="post-tag btn btn-outline-primary" href="/tags/class-wrapper/">Class Wrapper</a> <a class="post-tag btn btn-outline-primary" href="/tags/decorator-pattern/">Decorator Pattern</a> <a class="post-tag btn btn-outline-primary" href="/tags/enum/">Enum</a> <a class="post-tag btn btn-outline-primary" href="/tags/facade-pattern/">Facade Pattern</a> <a class="post-tag btn btn-outline-primary" href="/tags/face-of-a-building/">Face of a building</a> <a class="post-tag btn btn-outline-primary" href="/tags/game/">game</a> <a class="post-tag btn btn-outline-primary" href="/tags/game/">Game</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/ios/ios%20beta%20build/iOS-Custom-Build-Scheme/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1688297470" data-df="ll" > Jul 2, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Distribute iOS Beta Build (Scheme & Configurations)</h4><div class="text-muted small"><p> üåë Outline Having multiple build configurations during the application‚Äôs development phase is a good practice. Customers can ask for both debug and release configuration builds. Beta and Alpha test...</p></div></div></a></div><div class="col"> <a href="/posts/ios/swift/enum-in-swift/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1689411120" data-df="ll" > Jul 15, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Enum in Swift</h4><div class="text-muted small"><p> 1 2 3 4 5 6 7 8 guard let category = attributes.filter({ if case .category(_) = $0 { return true } return false }).first, case .category(let categoryMask...</p></div></div></a></div><div class="col"> <a href="/posts/apps/apps-games-ConnectBall/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1694317510" data-df="ll" > Sep 10, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Game - Connect Balls</h4><div class="text-muted small"><p> It is about: School time Memories are always there to cherish. Playing games on paper while the teacher is present in the classroom is what everyone remembers. This was one of the games I playe...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ios/ios%20beta%20build/iOS-Custom-Build-Scheme/" class="btn btn-outline-primary" prompt="Older" ><p>Distribute iOS Beta Build (Scheme & Configurations)</p></a> <a href="/posts/ios/swift/enum-in-swift/" class="btn btn-outline-primary" prompt="Newer" ><p>Enum in Swift</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'http://chewcode.blog/posts/ios/ios%20memory%20management/arc-in-swift/'; this.page.identifier = '/posts/ios/ios%20memory%20management/arc-in-swift/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https-nagpal-saurav-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/apps/">Apps</a> <a class="post-tag btn btn-outline-primary" href="/tags/apps/">apps</a> <a class="post-tag btn btn-outline-primary" href="/tags/arc/">ARC</a> <a class="post-tag btn btn-outline-primary" href="/tags/class-wrapper/">Class Wrapper</a> <a class="post-tag btn btn-outline-primary" href="/tags/decorator-pattern/">Decorator Pattern</a> <a class="post-tag btn btn-outline-primary" href="/tags/enum/">Enum</a> <a class="post-tag btn btn-outline-primary" href="/tags/facade-pattern/">Facade Pattern</a> <a class="post-tag btn btn-outline-primary" href="/tags/face-of-a-building/">Face of a building</a> <a class="post-tag btn btn-outline-primary" href="/tags/game/">game</a> <a class="post-tag btn btn-outline-primary" href="/tags/game/">Game</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p><p>¬© 2023 <a href="https://twitter.com/nagpalsaurav">Saurav Nagpal</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-N25MXEZMRV"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-N25MXEZMRV'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
